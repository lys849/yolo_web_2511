<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>YOLO 物体识别网站</title>
        <style>
            body { font-family: sans-serif; text-align: center; margin-top: 40px;}
            img { max-width: 80%; margin-top: 20px; border: 1px solid #ccc;}
        </style>
    </head>
    <body>
        <h1>上传图片进行物体识别</h1>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="upload()">识别图片</button>
        
        <div id="result"></div>
        <img id="output" style="display:none"/>

        <script src="config.js"></script>
        <script>
            async function upload() {
                const fileInput = document.getElementById("fileInput");
                const file = fileInput.files[0];
                if (!file){
                    alert("请先选择图片文件");
                    return;
                }
                const formData = new FormData();
                formData.append('file',file);

                document.getElementById('result').innerText = '识别中...';

                try {
                    const response = await fetch(`${window.SERVER_IP}/predict/`,{
                        method:'POST',
                        body: formData,
                    });
                    const data = await response.json();
                    console.log("后端返回：",data);

                    document.getElementById("result").innerText =JSON.stringify(data.detections, null, 2);

                    if (data.result_img) {
                        // 后端返回的是本地路径，不能直接用，需要处理掉前面的 "./project"
                        const cleaned = data.result_img.replace("./project", "");

                        document.getElementById("output").src =`${window.SERVER_IP}${cleaned}`;
                        document.getElementById("output").style.display = "block";
                        }
                    }catch (error) {
                    console.error(error);
                    document.getElementById("result").innerText = "识别失败";
                }
            }
        </script>
    </body>
</html>